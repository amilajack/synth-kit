<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>instrument.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#add">add</a></li><li><a href="global.html#adshr">adshr</a></li><li><a href="global.html#after">after</a></li><li><a href="global.html#bypass">bypass</a></li><li><a href="global.html#connect">connect</a></li><li><a href="global.html#constant">constant</a></li><li><a href="global.html#context">context</a></li><li><a href="global.html#contextOf">contextOf</a></li><li><a href="global.html#dest">dest</a></li><li><a href="global.html#detune">detune</a></li><li><a href="global.html#feedback">feedback</a></li><li><a href="global.html#fetch">fetch</a></li><li><a href="global.html#filter">filter</a></li><li><a href="global.html#gain">gain</a></li><li><a href="global.html#generate">generate</a></li><li><a href="global.html#inst">inst</a></li><li><a href="global.html#lifecycle">lifecycle</a></li><li><a href="global.html#load">load</a></li><li><a href="global.html#master">master</a></li><li><a href="global.html#mult">mult</a></li><li><a href="global.html#note">note</a></li><li><a href="global.html#now">now</a></li><li><a href="global.html#osc">osc</a></li><li><a href="global.html#oscBank">oscBank</a></li><li><a href="global.html#perc">perc</a></li><li><a href="global.html#plug">plug</a></li><li><a href="global.html#sample">sample</a></li><li><a href="global.html#samplingRate">samplingRate</a></li><li><a href="global.html#scale">scale</a></li><li><a href="global.html#seconds">seconds</a></li><li><a href="global.html#source">source</a></li><li><a href="global.html#tempo">tempo</a></li><li><a href="global.html#when">when</a></li><li><a href="global.html#white">white</a></li><li><a href="global.html#withNotes">withNotes</a></li><li><a href="global.html#withOptions">withOptions</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">instrument.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { contextOf, when, dest } from './context'
import { isFn, isObj } from './utils'
var slice = Array.prototype.slice

/**
 * @example
 * var synth = withNotes((fq) => return sine(fq))
 * synth('A4') // => play a 440Hz sound
 * synth(60) // => same as: play('C4')
 */
export function withNotes (fn) {
  return function () {

  }
}

/**
 * @example
 * var synth = withOptions(function (o) {
 *    return connect(sine(o.frequency),
 *      filter(o.filter.type, o.filter.frequency || o.frequency))
 * }, { frequency: 440, filter: { type: 'lowpass' }}, ['frequency'])
 * synth({ frequency: 'A4' })
 * synth('A4')
 */
export function withOptions (fn, config) {
  config = config || {}
  config.toOptions = config.toOptions || freqAndContextToOpts
  return function (options) {
    if (!isObj(options)) options = config.toOptions.apply(null, arguments)
    return fn(Object.assign({}, config.defaults, options))
  }
}
function freqAndContextToOpts (frequency, context) {
  return { frequency: frequency, context: context }
}

/**
 * A master output instrument. You can start nodes with it
 *
 * @example
 * master.start(sine(300))
 */
export var master = inst(null, dest())

/**
 * @example
 * // an instrument with destination
 * var synth = inst((fq) => sine(fq), dest())
 * synth.start('A4')
 * synth.stopAll()
 * @example
 * // only the destination
 * var master = inst(null, connect(mix(0.2), reverb(), dest()))
 * master.start(sine(300))
 * master.start(sine(400))
 * master.stopAll()
 */
export function inst (synth, destination, maxVoices) {
  var i = {}
  var voices = initVoices(maxVoices)
  i.start = function (value, time, delay, duration) {
    var node = isFn(synth) ? synth(value) : value
    if (destination) node.connect(destination)

    trackNode(voices, node)
    time = when(time, delay, contextOf(destination))
    node.start(time)
    if (duration) node.stop(time + duration)
    return node
  }
  i.stop = function () { return stopAll(voices) }
  i.inst = function (synth, maxVoices) { return inst(synth, destination, maxVoices) }
  i.on = on.bind(null, i)
  i.trigger = trigger.bind(null, i)
  return i
}

function initVoices (limit) {
  limit = limit || 0
  return { limit: limit, all: {}, nextId: 0, current: 0, pool: new Array(limit) }
}
function trackNode (voices, node) {
  node.id = voices.nextId++
  voices.all[node.id] = node
  return voices
}
function stopAll (voices) {
  Object.keys(voices.all).forEach(function (id) {
    voices.all[id].stop()
  })
}

export function on (target, event, callback) {
  if (!event || event === '*') event = 'event'
  var prev = target['on' + event]
  target['on' + event] = function () {
    if (prev) prev.apply(null, arguments)
    callback.apply(null, arguments)
  }
}

export function trigger (target, event /*, ...values */) {
  if (!isFn(target['on' + event])) return
  var args = slice.call(arguments, 2)
  target['on' + event].apply(null, args)
  if (isFn(target.onevent)) target.onevent.apply(null, args)
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.2</a> on Fri Oct 28 2016 12:58:38 GMT+0200 (CEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
