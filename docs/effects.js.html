<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>effects.js - Postman Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-buffers.html">buffers</a><ul class='methods'><li data-type='method'><a href="module-buffers.html#.gen">gen</a></li><li data-type='method'><a href="module-buffers.html#.sample">sample</a></li><li data-type='method'><a href="module-buffers.html#.source">source</a></li><li data-type='method'><a href="module-buffers.html#.white">white</a></li></ul></li><li><a href="module-context.html">context</a><ul class='methods'><li data-type='method'><a href="module-context.html#.after">after</a></li><li data-type='method'><a href="module-context.html#.context">context</a></li><li data-type='method'><a href="module-context.html#.dest">dest</a></li><li data-type='method'><a href="module-context.html#.now">now</a></li><li data-type='method'><a href="module-context.html#.samplingRate">samplingRate</a></li><li data-type='method'><a href="module-context.html#.timeToSamples">timeToSamples</a></li><li data-type='method'><a href="module-context.html#.when">when</a></li></ul></li><li><a href="module-effects.html">effects</a><ul class='methods'><li data-type='method'><a href="module-effects.html#.convolve">convolve</a></li><li data-type='method'><a href="module-effects.html#.decayIR">decayIR</a></li><li data-type='method'><a href="module-effects.html#.delay">delay</a></li><li data-type='method'><a href="module-effects.html#.dly">dly</a></li><li data-type='method'><a href="module-effects.html#.feedback">feedback</a></li><li data-type='method'><a href="module-effects.html#.mix">mix</a></li><li data-type='method'><a href="module-effects.html#.reverb">reverb</a></li><li data-type='method'><a href="module-effects.html#.tremolo">tremolo</a></li></ul></li><li><a href="module-envelopes.html">envelopes</a><ul class='methods'><li data-type='method'><a href="module-envelopes.html#.adsr">adsr</a></li><li data-type='method'><a href="module-envelopes.html#.freqEnv">freqEnv</a></li><li data-type='method'><a href="module-envelopes.html#.perc">perc</a></li></ul></li><li><a href="module-filters.html">filters</a><ul class='methods'><li data-type='method'><a href="module-filters.html#.bandpass">bandpass</a></li><li data-type='method'><a href="module-filters.html#.filter">filter</a></li><li data-type='method'><a href="module-filters.html#.hipass">hipass</a></li><li data-type='method'><a href="module-filters.html#.lowpass">lowpass</a></li></ul></li><li><a href="module-instruments.html">instruments</a><ul class='methods'><li data-type='method'><a href="module-instruments.html#.inst">inst</a></li></ul></li><li><a href="module-load.html">load</a><ul class='methods'><li data-type='method'><a href="module-load.html#.decodeAudio">decodeAudio</a></li><li data-type='method'><a href="module-load.html#.fetch">fetch</a></li><li data-type='method'><a href="module-load.html#.load">load</a></li></ul></li><li><a href="module-oscillators.html">oscillators</a><ul class='methods'><li data-type='method'><a href="module-oscillators.html#.lfo">lfo</a></li><li data-type='method'><a href="module-oscillators.html#.osc">osc</a></li><li data-type='method'><a href="module-oscillators.html#.saw">saw</a></li><li data-type='method'><a href="module-oscillators.html#.sine">sine</a></li><li data-type='method'><a href="module-oscillators.html#.square">square</a></li><li data-type='method'><a href="module-oscillators.html#.triangle">triangle</a></li></ul></li><li><a href="module-routing.html">routing</a><ul class='methods'><li data-type='method'><a href="module-routing.html#.add">add</a></li><li data-type='method'><a href="module-routing.html#.conn">conn</a></li></ul></li><li><a href="module-signals.html">signals</a><ul class='methods'><li data-type='method'><a href="module-signals.html#.bypass">bypass</a></li><li data-type='method'><a href="module-signals.html#.constant">constant</a></li><li data-type='method'><a href="module-signals.html#.gain">gain</a></li><li data-type='method'><a href="module-signals.html#.mult">mult</a></li><li data-type='method'><a href="module-signals.html#.scale">scale</a></li><li data-type='method'><a href="module-signals.html#.signal">signal</a></li></ul></li><li><a href="module-synths.html">synths</a><ul class='methods'><li data-type='method'><a href="module-synths.html#.bank">bank</a></li><li data-type='method'><a href="module-synths.html#.subtractive">subtractive</a></li><li data-type='method'><a href="module-synths.html#.vca">vca</a></li><li data-type='method'><a href="module-synths.html#.vcf">vcf</a></li><li data-type='method'><a href="module-synths.html#.withDefaults">withDefaults</a></li></ul></li><li><a href="module-units.html">units</a><ul class='methods'><li data-type='method'><a href="module-units.html#.dBToGain">dBToGain</a></li><li data-type='method'><a href="module-units.html#.gainToDb">gainToDb</a></li><li data-type='method'><a href="module-units.html#.levelToGain">levelToGain</a></li><li data-type='method'><a href="module-units.html#.midiToFreq">midiToFreq</a></li><li data-type='method'><a href="module-units.html#.noteToFreq">noteToFreq</a></li><li data-type='method'><a href="module-units.html#.tempoToFreq">tempoToFreq</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">effects.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module effects */
import { context, samplingRate } from './context'
import { add, conn, plug, lifecycle } from './routing'
import { bypass, gain } from './signals'
import { isA, OPTS } from './utils'
import { osc } from './oscillators'
import { lowpass } from './filters'
import { gen, white } from './buffers'

/**
 * Mix an effect with the signal. Can be partially applied to create an
 * effect bus.
 * @param {Number} wet - the amount of effect (0-1)
 * @param {AudioNode} fx - the effect unit
 * @param {Object} options - (Optional) may include:
 *
 * - compensate: it it's false, the dry signal gain will pass without reduction.
 * If true (it's true by default) the dry signal is reduced the gain of the wet signal.
 * - context: the audio context
 *
 * @return {AudioNode}
 * @example
 * mix(dB(-3), delay(ms(800)))
 * @example
 * // create an effect bus
 * var rev = mix(reverb(2))
 * conn(sine(300), rev(0.2))
 */
export function mix (wet, fx, opts) {
  if (arguments.length === 1) return function (w, o) { return mix(w, wet, o) }
  if (!isA('number', wet)) wet = 0.5
  opts = opts || OPTS
  var dry = opts.compensate === false ? 1 : 1 - wet
  console.log('MIX', wet, dry, opts)
  return add(gain(dry), conn(fx, gain(wet)))
}

/**
 * Create a feedback loop.
 * @param {Integer} amount - the amount of signal
 * @param {AudioNode} node - the node to feedback
 * @param {Object} options - (Optional) options may include:
 *
 * - context: the audio context to use
 *
 * @return {AudioNode} the original node (with a feedback loop)
 */
export function feedback (amount, node, options) {
  var feed = gain(amount, options)
  node.conn(feed)
  feed.conn(node)
  return node
}

/**
 * Create a tremolo
 */
export function tremolo (rate, type, ac) {
  type = type || 'sine'
  return gain(osc(type, rate, ac), ac)
}

/**
 * Create a delay (a DelayNode object)
 */
export function dly (time, opts) {
  opts = opts || OPTS
  var dly = context(opts.context).createDelay(5)
  return lifecycle(dly, [
    plug('delayTime', time, dly)
  ])
}

/**
 * Create a convolver
 * @param {AudioBuffer} buffer
 * @param {Object} options - (Optional) options may include:
 *
 * - normalize: true to normalize the buffer
 * - context: the audio context to use
 *
 * @return {AudioNode} the convolver (ConvolverNode)
 * @example
 * reverb = mix(convolve(sample('emt-140.wav')))
 * connect(subtractive(880, { perc: [0.1, 1] }), reverb(0.2))
 */
export function convolve (buffer, o) {
  o = o || OPTS
  var c = context(o.context).createConvolver()
  c.buffer = isA('function', buffer) ? buffer() : buffer
  if (o.normalize === true) c.normalize = true
  return c
}

/**
 * Create a reverb impulse response using a logarithmic decay white noise
 * @param {Number} duration - the duration in samples
 * @param {Object} options - (Optional) options may include:
 *
 * - decay: the decay length in samples
 * - attack: the attack time in samples
 * - reverse: get the reversed impulse
 * - context: the context to use
 *
 * @return {AudioBuffer} the impulse response audio buffer
 */
export function decayIR (samples, opts) {
  samples = samples || 10000
  opts = opts || OPTS
  var attack = opts.attack || Math.floor(samples / 10)
  var decay = opts.decay || samples - attack
  // 60dB is a factor of 1 million in power, or 1000 in amplitude.
  var base = Math.pow(1 / 1000, 1 / decay)
  return gen(function (i) {
    var dec = base ? Math.pow(base, i) : 1
    var att = i &lt; attack ? (i / attack) : 1
    return att * white.generator(i) * dec
  }, samples, opts)
}

/**
 * Create a simple reverb
 * @param {Number} duration - in seconds? WTF?
 */
export function reverb (duration, opts) {
  opts = opts || OPTS
  var rate = samplingRate(opts.context)
  return convolve(decayIR(duration * rate, opts), opts)
}

/**
 * A mono or stereo delay with filtered feedback
 */
export function delay (time, filter, feedAmount, ac) {
  if (!isA('number', feedAmount)) feedAmount = 0.3
  filter = isA('number', filter) ? lowpass(filter, null, null, ac) : filter || bypass(ac)
  return feedback(feedAmount, dly(time, ac), filter, ac)
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Mon Nov 14 2016 12:23:13 GMT+0100 (CET)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
