<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>envelopes.js - Postman Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-buffers.html">buffers</a><ul class='methods'><li data-type='method'><a href="module-buffers.html#.gen">gen</a></li><li data-type='method'><a href="module-buffers.html#.sample">sample</a></li><li data-type='method'><a href="module-buffers.html#.source">source</a></li><li data-type='method'><a href="module-buffers.html#.white">white</a></li></ul></li><li><a href="module-context.html">context</a><ul class='methods'><li data-type='method'><a href="module-context.html#.after">after</a></li><li data-type='method'><a href="module-context.html#.context">context</a></li><li data-type='method'><a href="module-context.html#.dest">dest</a></li><li data-type='method'><a href="module-context.html#.now">now</a></li><li data-type='method'><a href="module-context.html#.samplingRate">samplingRate</a></li><li data-type='method'><a href="module-context.html#.timeToSamples">timeToSamples</a></li><li data-type='method'><a href="module-context.html#.when">when</a></li></ul></li><li><a href="module-effects.html">effects</a><ul class='methods'><li data-type='method'><a href="module-effects.html#.delay">delay</a></li><li data-type='method'><a href="module-effects.html#.dly">dly</a></li><li data-type='method'><a href="module-effects.html#.feedback">feedback</a></li><li data-type='method'><a href="module-effects.html#.mix">mix</a></li><li data-type='method'><a href="module-effects.html#.tremolo">tremolo</a></li></ul></li><li><a href="module-envelopes.html">envelopes</a><ul class='methods'><li data-type='method'><a href="module-envelopes.html#.adshr">adshr</a></li><li data-type='method'><a href="module-envelopes.html#.freqEnv">freqEnv</a></li><li data-type='method'><a href="module-envelopes.html#.perc">perc</a></li></ul></li><li><a href="module-filters.html">filters</a><ul class='methods'><li data-type='method'><a href="module-filters.html#.bandpass">bandpass</a></li><li data-type='method'><a href="module-filters.html#.filter">filter</a></li><li data-type='method'><a href="module-filters.html#.hipass">hipass</a></li><li data-type='method'><a href="module-filters.html#.lowpass">lowpass</a></li></ul></li><li><a href="module-instrument.html">instrument</a><ul class='methods'><li data-type='method'><a href="module-instrument.html#.inst">inst</a></li><li data-type='method'><a href="module-instrument.html#.withOptions">withOptions</a></li></ul></li><li><a href="module-load.html">load</a><ul class='methods'><li data-type='method'><a href="module-load.html#.decodeAudio">decodeAudio</a></li><li data-type='method'><a href="module-load.html#.fetch">fetch</a></li><li data-type='method'><a href="module-load.html#.load">load</a></li></ul></li><li><a href="module-oscillators.html">oscillators</a><ul class='methods'><li data-type='method'><a href="module-oscillators.html#.lfo">lfo</a></li><li data-type='method'><a href="module-oscillators.html#.osc">osc</a></li><li data-type='method'><a href="module-oscillators.html#.oscBank">oscBank</a></li><li data-type='method'><a href="module-oscillators.html#.saw">saw</a></li><li data-type='method'><a href="module-oscillators.html#.sine">sine</a></li><li data-type='method'><a href="module-oscillators.html#.square">square</a></li><li data-type='method'><a href="module-oscillators.html#.triangle">triangle</a></li></ul></li><li><a href="module-routing.html">routing</a><ul class='methods'><li data-type='method'><a href="module-routing.html#.add">add</a></li><li data-type='method'><a href="module-routing.html#.connect">connect</a></li></ul></li><li><a href="module-signals.html">signals</a><ul class='methods'><li data-type='method'><a href="module-signals.html#.bypass">bypass</a></li><li data-type='method'><a href="module-signals.html#.constant">constant</a></li><li data-type='method'><a href="module-signals.html#.gain">gain</a></li><li data-type='method'><a href="module-signals.html#.mult">mult</a></li><li data-type='method'><a href="module-signals.html#.scale">scale</a></li><li data-type='method'><a href="module-signals.html#.signal">signal</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#dB">dB</a></li><li><a href="global.html#gainToDb">gainToDb</a></li><li><a href="global.html#note">note</a></li><li><a href="global.html#tempo">tempo</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">envelopes.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module envelopes */
import { context, when } from './context'
import { scale } from './signals'
import { isA } from './units'

function schedule (param, shape, times, types, ac) {
  return function (time, delay) {
    console.log(shape, times, types)
    var type
    time = when(time, delay, ac)
    var lt = times.length
    var tp = types.length
    shape.forEach(function (value, i) {
      time += times[i % lt]
      type = types[i % tp]
      console.log(value, time, type)
      if (type === 'set') param.setValueAtTime(value, time)
      else if (type === 'exp') param.exponentialRampToValueAtTime(value === 0 ? 0.00001 : value, time)
      else param.linearRampToValueAtTime(value, time)
    })
  }
}

export function env (shape, times, types, ac) {
  var ctx = context(ac)
  var gain = ctx.createGain()
  gain.gain.value = 0
  gain.start = schedule(gain.gain, shape, times, types, ctx)
  return gain
}

function toNum (num, def) { return isA('number', num) ? num : def }
/**
 * An attack-decay-sustain-(hold)-decay envelope
 */
export function adshr (attack, decay, sustain, hold, release, ac) {
  attack = toNum(attack, 0.01)
  decay = toNum(decay, 0.1)
  sustain = toNum(sustain, 1)
  hold = toNum(hold, 0)
  release = toNum(release, 0.3)
  return env([0, 1, sustain, sustain, 0],
    [0, attack, decay, hold, release],
    ['set', 'lin', 'set', 'exp'], ac)
}

/**
 * An attack-decay envelope
 */
export function perc (attack, decay, ac) {
  return adshr(attack, 0, 1, 0, decay, ac)
}

/**
 * A frequency envelope. Basically the setup to provide an adsr over a
 * number of octaves.
 * @param {Number} frequency - the initial frequency
 * @param {Number} octaves - (Optional) the number of octaves of the envelope (1 by default)
 * @param {Number} attack - (Optional) the attack length in seconds
 * @param {Number} decay - (Optional) the decay length in seconds
 * @param {Number} sustain - (Optional) the sustain gain (from 0 to 1)
 * @param {Number} release - (Optional) the release length in seconds
 * @param {AudioContext} context - the optional audio context
 */
export function freqEnv (freq, octs, a, d, s, r, ac) {
  // TODO: use adsr
  return scale(freq, freq * Math.pow(2, octs), adshr(a, d, s, 0, r, ac))
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Sun Oct 30 2016 11:24:39 GMT+0100 (CET)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
